CREATE DATABASE QUAN_LY_THUE_XE_PH28706

IF OBJECT_ID('KHACHHANG') IS NOT NULL
DROP TABLE KHACHHANG
CREATE TABLE KHACHHANG(
MAKHACH CHAR(10) PRIMARY KEY,
HOTEN NVARCHAR(50),
DIACHI NVARCHAR(50),
SDT NVARCHAR(10),
SOCANCUOC NVARCHAR(50)
)

IF OBJECT_ID('XE') IS NOT NULL
DROP TABLE XE
CREATE TABLE XE(
BIENSO NVARCHAR(50) PRIMARY KEY,
SOGHE INT,
DONGIA MONEY CHECK(DONGIA >= 0),
HANGXE NVARCHAR(50)
);

IF OBJECT_ID('THUEXE') IS NOT NULL
DROP TABLE THUEXE 
CREATE TABLE THUEXE(
MAKHACH CHAR(10),
BIENSO NVARCHAR(50),
NGAYTHUE DATE,
NGAYTRA DATE,
FOREIGN KEY (MAKHACH) REFERENCES KHACHHANG(MAKHACH),
FOREIGN KEY (BIENSO) REFERENCES XE(BIENSO),
PRIMARY KEY (MAKHACH, BIENSO, NGAYTHUE)
);

INSERT INTO KHACHHANG(MAKHACH, HOTEN, DIACHI, SDT, SOCANCUOC) VALUES 
('KH111',N'TRẦN THỊ THU PHƯƠNG', N'SẦM SƠN', '0969691630', '038303002932'),
('KH122',N'LÊ HỒNG ĐĂNG', N'10-LÊ TRỌNG TẤN', '0988845633', '003647000282'),
('KH123',N'TRẦN VĂN THỦY', N'27-HÀNG HOA THÁM', '0982345612', '013634005567');

INSERT INTO XE(BIENSO, SOGHE, DONGIA, HANGXE) VALUES 
('29H-1234',50, 500, N'TOYOTA'),
('29N-2221',7, 200, N'HONDA'),
('29A-1432',29, 350, N'FORD');
DELETE FROM XE
INSERT INTO THUEXE(MAKHACH, BIENSO, NGAYTHUE, NGAYTRA) VALUES 
('KH122','29N-2221', '2022/03/20', '2022/03/25'),
('KH122','29N-2221', '2022/01/10','2022/01/12'),
('KH123','29H-1234', '2021/03/10', '2021/03/18');

SELECT * FROM KHACHHANG WHERE HOTEN LIKE 'LÊ%'
SELECT * FROM KHACHHANG WHERE SDT LIKE '098_______'
SELECT * FROM XE WHERE DONGIA = (SELECT MAX(DONGIA) FROM XE WHERE HANGXE LIKE 'FORD')
SELECT * FROM  
UPDATE XE SET DONGIA = DONGIA * 0.8 WHERE SOGHE > 20 
DELETE FROM THUEXE WHERE NGAYTHUE < '2022/01/01'
