CREATE DATABASE ONTAP
IF OBJECT_ID('KHOA ') IS NOT NULL
DROP TABLE KHOA
CREATE TABLE KHOA(
    MAKH VARCHAR(50),
    TENKH NVARCHAR(50),
    SLSV INT,
);
IF OBJECT_ID('SINHVIEN') IS NOT NULL
DROP TABLE SINHVIEN
CREATE TABLE SINHVIEN(
    MASV VARCHAR(50),
    HOSV NVARCHAR(50),
    TENSV NVARCHAR(50),
    PHAI NVARCHAR(50),
    NGAYSINH DATETIME,
    NOISINH NVARCHAR(50),
    MAKH VARCHAR(50),
    HOCBONG MONEY,
    DIEMTB NUMERIC(4,2),
);
IF OBJECT_ID('MONHOC') IS NOT NULL
DROP TABLE MONHOC
CREATE TABLE MONHOC(
    MAMH VARCHAR(50),
    TENMH NVARCHAR(50),
    SOTIET TINYINT,

);
IF OBJECT_ID('KETQUA') IS NOT NULL
DROP TABLE KETQUA
CREATE TABLE KETQUA(
    MASV VARCHAR(50),
    LANTHI TINYINT,
    DIEM NUMERIC,
    KETQUA NVARCHAR(50),
    MAMH VARCHAR(30),
);

INSERT INTO KHOA (MAKH,TENKH) VALUES
('HTTT',N'HỆ THỐNG THÔNG TIN'),
('MANG',N'MẠNG VÀ TRUYỀN THÔNG');
SELECT * FROM KHOA

INSERT INTO MONHOC(MAMH,TENMH,SOTIET) VALUES
('CSDL',N'CƠ SỞ DỮ LIỆU','45'),
('TTNT',N'TRÍ TUỆ NHÂN TẠO','45'),
('MMT',N'MẠNG MÁY TÍNH','45'),
('DHMT',N'ĐỒ HOẠ MÁY TÍNH','60'),
('CTDL',N'CẤU TRÚC DỮ LIỆU','60');
SELECT * FROM MONHOC

INSERT INTO SINHVIEN(MASV,HOSV,TENSV,PHAI,NGAYSINH,NOISINH,MAKH,HOCBONG,DIEMTB) VALUES
('SV01',N'LÊ KIM',N'LAN',N'NỮ','1990/02/23',N'HÀ NỘI','HTTT','130000','8'),
('SV02',N'TRẦN MINH',N'CHÁNH',N'NỮ','1992/12/24',N'BÌNH ĐỊNH','MANG','150000','9'),
('SV03',N'LÊ AN',N'TUYẾT',N'NỮ','1991/02/21',N'HẢI PHÒNG','HTTT','170000','7'),
('SV04',N'TRẦN ANH',N'TUẤN',N'NAM','1993/12/20',N'TPHCM','MANG','80000','9'),
('SV05',N'TRẦN THỊ',N'MAI',N'NỮ','1991/12/08',N'TPHCM','CNPM','0','9'),
('SV06',N'LÊ THỊ THU',N'THUỶ',N'NỮ','1991/01/02',N'AN GIANG','HTTT','0','8'),
('SV07',N'NGUYỄN KIM',N'THƯ',N'NỮ','1990/02/02',N'HÀ NỘI','CNPM','180000','8'),
('SV08',N'LÊ VĂN',N'LONG',N'NAM','1992/12/08',N'TPHCM','HTTT','190000','9');
SELECT * FROM SINHVIEN

INSERT INTO KETQUA(MASV,MAMH,LANTHI,DIEM) VALUES
    ('SV01', 'CSDL', '1', '3'),
    ('SV01', 'CSDL', '2', '6'),
    ('SV01', 'TTNT', '1', '5.5'),
    ('SV01', 'TTNT', '2', '6'),
    ('SV01', 'MMT', '1', '5'),
    ('SV02', 'CSDL', '1', '4.5'),
    ('SV02', 'CSDL', '2', '7'),
    ('SV02', 'MMT', '1', '10'),
    ('SV02', 'CTDL', '1', '9'),
    ('SV03', 'CSDL', '1', '2'),
    ('SV03', 'CSDL', '2', '5'),
    ('SV03', 'MMT', '1', '2.5'),
    ('SV03', 'MMT', '2', '4'),
    ('SV04', 'CSDL', '1', '4.5'),
    ('SV04', 'CTDL', '1', '10'),
    ('SV05', 'CSDL', '1', '7'),
    ('SV05', 'MMT', '1', '2.5'),
    ('SV05', 'MMT', '2', '5'),
    ('SV06', 'TTNT', '1', '6'),
    ('SV06', 'DHMT', '1', '10');
    SELECT * FROM KETQUA
---------11
SELECT MASV,HOSV,TENSV,HOCBONG FROM SINHVIEN ORDER BY MASV

----------12
SELECT * FROM SINHVIEN ORDER BY PHAI, TENSV ASC

-----------13
SELECT  DISTINCT NOISINH FROM SINHVIEN

-----------14
SELECT MAMH,TENMH,SOTIET FROM MONHOC WHERE TENMH LIKE 'T%'

-----------15
SELECT HOSV,TENSV,HOCBONG FROM SINHVIEN WHERE HOCBONG < 160000 AND NOISINH = N'TPHCM'


----------16
SELECT MASV,MAKH FROM SINHVIEN WHERE MAKH = 'CNTT' OR MAKH ='HTTT'

----------17
SELECT MASV,NGAYSINH,NOISINH,HOCBONG FROM SINHVIEN WHERE NGAYSINH > '01/01/1991 ' AND NGAYSINH < '05/06/1992 ' 



------3
UPDATE MONHOC
SET SOTIET = '45'
WHERE MAMH = 'CTDL';

-------4
UPDATE SINHVIEN
SET HOSV = 'LÊ KIM', TENSV='LÂN',PHAI='NAM'
WHERE MASV = 'SV01';
SELECT*FROM SINHVIEN

---------5
UPDATE SINHVIEN
SET HOCBONG = HOCBONG*1.2
WHERE MAKH = 'MANG';

-----------6
UPDATE KETQUA
SET KETQUA ='D'
WHERE DIEM > 0 AND DIEM < 5;

UPDATE KETQUA
SET KETQUA ='K'
WHERE DIEM > 5 AND DIEM < 10;
SELECT * FROM KETQUA

------------7
UPDATE SINHVIEN
SET DIEMTB = (SELECT AVG(DIEM) FROM KETQUA WHERE MASV = 'SV01' AND LANTHI = 1)
WHERE MASV = 'SV01';
SELECT * FROM SINHVIEN
-----------8
UPDATE SINHVIEN
SET DIEMTB = (SELECT AVG(DIEM) FROM KETQUA WHERE MASV = SINHVIEN.MASV AND LANTHI = 1)
WHERE MASV = 'SV01';



--30--
select MAKH, sum(HOCBONG) as tongHocBong from sinhVien group by MAKH



SELECT MAKH, SUM(HOCBONG) AS TONGHOCBONG FROM SINHVIEN GROUP BY MAKH
--31--
select MAKH, max(HOCBONG) from sinhVien group by MAKH


--31
SELECT MAKH, MAX(HOCBONG) AS TONGHOCBONGCAO FROM SINHVIEN GROUP BY MAKH
--32--
select MAKH ,COUNT(MASV) as tongSoNam from sinhVien 
where PHAI = N'Nam'
group by MAKH

select MAKH ,COUNT(MASV) as tongSoNu from sinhVien 
where PHAI = N'Nữ'
group by MAKH

---32
SELECT MAKH , COUNT(MASV) AS TONGNAM FROM SINHVIEN
WHERE PHAI = N'NAM'
GROUP BY MAKH
--30
SELECT MAKH, SUM(HOCBONG) AS TONGHOCBONG FROM SINHVIEN GROUP BY MAKH

--31
SELECT MAKH, MAX(HOCBONG) AS HOCBONGCAO FROM SINHVIEN GROUP BY MAKH


--32
SELECT MAKH, COUNT(MASV) AS TONGNAM FROM SINHVIEN
WHERE PHAI =N'NAM'
GROUP BY MAKH
--33--
select YEAR(getdate())-YEAR(NGSINH) as doTuoi, COUNT(MASV) as soLuongSV from sinhVien
group by YEAR(getdate())-YEAR(NGSINH)
--34--
select NOISINH, COUNT(MASV) as soSV from sinhVien
group by NOISINH
having COUNT(NOISINH) >=2
--35--
select MAMH, COUNT(distinct MASV) soSVDuThi from KETQUA
group by MAMH
having COUNT(distinct MASV) >3
--36--





--28
SELECT MAMH, COUNT(DISTINCT MASV) AS SOLUONGSV FROM KETQUA GROUP BY MAMH

SELECT MAMH,COUNT(DISTINCT MASV) AS SOLUONGSV FROM KETQUA GROUP BY MAMH

--30
SELECT MAKH,SUM(HOCBONG) AS TONGHOCBONG FROM SINHVIEN GROUP BY MAKH








SELECT MASV, COUNT(DISTINCT MAMH) AS SOLUONGMONHOC FROM  KETQUA GROUP BY MASV