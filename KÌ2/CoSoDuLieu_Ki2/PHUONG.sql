CREATE DATABASE BAT_DONG_SAN_WE30

IF OBJECT_ID('VANPHONG') IS NOT NULL
DROP TABLE VANPHONG
CREATE TABLE VANPHONG(
MAVP CHAR(10) PRIMARY KEY,
DIADIEM NVARCHAR(50),
TRUONGPHONG CHAR(10),
);
IF OBJECT_ID('NHANVIEN') IS NOT NULL
DROP TABLE NHANVIEN
CREATE TABLE NHANVIEN(
MANV CHAR(10) PRIMARY KEY,
HOTENNV NVARCHAR(50),
MAVP CHAR(10),
FOREIGN KEY (MAVP) REFERENCES VANPHONG(MAVP)
);
IF OBJECT_ID('THANNHAN') IS NOT NULL
DROP TABLE THANNHAN
CREATE TABLE THANNHAN(
HOTENTN NVARCHAR(50),
NGAYSINH DATE,
MOIQUANHE NVARCHAR(50),
MANV CHAR(10),
PRIMARY KEY (HOTENTN, NGAYSINH, MOIQUANHE, MANV),
FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)
);
IF OBJECT_ID('CHUSOHUU') IS NOT NULL
DROP TABLE CHUSOHUU
CREATE TABLE CHUSOHUU(
MACSH CHAR(10),
HOTENCSH NVARCHAR(50),
DIACHICSH NVARCHAR(50),
SĐT CHAR(10),
PRIMARY KEY (MACSH)
);
IF OBJECT_ID('BDS') IS NOT NULL
DROP TABLE BDS
CREATE TABLE BDS(
MABDS CHAR(10),
DIACHI NVARCHAR(50),
MACSH CHAR(10),
MAVP CHAR(10),
PRIMARY KEY (MABDS),
FOREIGN KEY (MACSH) REFERENCES CHUSOHUU(MACSH),
FOREIGN KEY (MAVP) REFERENCES VANPHONG(MAVP)
);
IF OBJECT_ID('BDSDA_BAN') IS NOT NULL
DROP TABLE BDSDA_BAN
CREATE TABLE BDSDA_BAN(
MABDS CHAR(10),
NGAYBAN DATE,
GIABAN NVARCHAR(50),
MANV CHAR(10),
PRIMARY KEY (MABDS, MANV),
FOREIGN KEY (MABDS) REFERENCES BDS(MABDS),
FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)
);

SELECT * FROM NHANVIEN
ALTER TABLE NHANVIEN ADD GIOITINH NVARCHAR(30);


ALTER TABLE NHANVIEN DROP COLUMN GIOITINH
SELECT * FROM NHANVIEN

SELECT * FROM VANPHONG
SELECT * FROM NHANVIEN
SELECT * FROM THANNHAN
SELECT * FROM CHUSOHUU
SELECT * FROM BDS
SELECT * FROM BDSDA_BAN

INSERT INTO VANPHONG(MAVP,DIADIEM,TRUONGPHONG) VALUES
('VP01',N'SỐ 1 - TRỊNH VĂN BÔ A','NV01'),
('VP02',N'SỐ 1 - TRỊNH VĂN BÔ B','NV02'),
('VP03',N'SỐ 1 - TRỊNH VĂN BÔ C','NV03'),
('VP04',N'SỐ 1 - TRỊNH VĂN BÔ D','NV04');
INSERT INTO NHANVIEN(MANV,HOTENNV,MAVP) VALUES
('NV01',N'NGUYỄN VĂN A','VP01'),
('NV02',N'NGUYỄN VĂN B','VP02'),
('NV03',N'NGUYỄN VĂN C','VP03'),
('NV04',N'NGUYỄN VĂN D','VP04');
INSERT INTO THANNHAN(HOTENTN, NGAYSINH, MOIQUANHE, MANV) VALUES
(N'LÊ TUYẾT A','2003/08/31',N'VỢ','NV01'),
(N'LÊ TUYẾT B','2003/08/09',N'VỢ','NV02'),
(N'MẠNH DẠN A','2005/10/25',N'CHỒNG','NV03'),
(N'ĐING TIẾN A','2006/11/08',N'CHỒNG','NV04');
INSERT INTO CHUSOHUU(MACSH,HOTENCSH,DIACHICSH,SĐT) VALUES
('CSH01',N'ĐING VĂN A',N'46 - HÀNG GÀ', '0916882245'),
('CSH02',N'TRẦN THỊ THU PHƯƠNG',N'140 - HÀNG BỒ', '0916575645'),
('CSH03',N'ĐINH VĂN B',N'33 - HÀNG THIẾC', '0913123455'),
('CSH04',N'ĐÙNG VĂN C',N'57 - HÀNG THANG', '0916844245');
INSERT INTO BDS(MABDS, DIACHI,MACSH,MAVP) VALUES
('BDS01',N'36 - AI BIẾT ĐÂU', 'CSH01', 'VP01'),
('BDS02',N'37 - À HÌNH NHƯ BIẾT', 'CSH02', 'VP02'),
('BDS03',N'38 - KHOAN NHẦM RỒI', 'CSH03', 'VP03'),
('BDS04',N'39 - Ừ NHẦM THẬT', 'CSH04', 'VP04');
INSERT INTO BDSDA_BAN(MABDS,NGAYBAN,GIABAN,MANV) VALUES
('BDS01','2021/09/12',120000,'NV01'),
('BDS02','2022/11/28',150300,'NV02'),
('BDS03','2022/07/04',160600,'NV03'),
('BDS04','2022/03/22',125000,'NV04');

SELECT HOTENNV
FROM NHANVIEN

SELECT *
FROM NHANVIEN
WHERE MAVP='VP01'

SELECT *, YEAR(GETDATE())- YEAR(NGAYSINH) AS N'TUOI'
FROM THANNHAN
WHERE YEAR(GETDATE())- YEAR(NGAYSINH) >17

SELECT *
FROM THANNHAN
WHERE HOTENTN LIKE N'% % A%'

SELECT *
FROM THANNHAN
WHERE NGAYSINH LIKE '2003%'

SELECT *
FROM NHANVIEN
WHERE HOTENNV LIKE N'% ___ %'

SELECT *
FROM THANNHAN
WHERE NGAYSINH = (SELECT MAX(NGAYSINH) FROM THANNHAN)


SELECT *
FROM BDSDA_BAN
WHERE GIABAN = (SELECT MAX(GIABAN) FROM BDSDA_BAN)

select * --(bds.*; lay thong tin bds, * lay tt ca 2 bang)
from BDS join BDSDA_BAN on bds.MABDS=BDSDA_BAN.MABDS
where  year(ngayban)=2022 and month(ngayban)=3